# DOUCMENTATION: https://docs.getdbt.com/reference/model-properties

version: 2

models:
  - name: weekly_dishes_variations
    description: "Table containing information about weekly menu variations for dishes"

    columns:
      - name: menu_year
        description: "{{ doc('column__menu_year') }}"
        data_type: int

      - name: menu_week
        description: "{{ doc('column__menu_week') }}"
        data_type: int

      - name: company_id
        description: "{{ doc('column__company_id') }}"
        data_type: string

      - name: weekly_menu_id
        description: "{{ doc('column__weekly_menu_id') }}"
        data_type: int

      - name: menu_id
        description: "{{ doc('column__menu_id') }}"
        data_type: int

      - name: product_variation_id
        description: "{{ doc('column__product_variation_id') }}"
        data_type: string

      - name: menu_recipe_id
        description: "{{ doc('column__menu_recipe_id') }}"
        data_type: int

      - name: recipe_id
        description: "{{ doc('column__recipe_id') }}"
        data_type: int

      - name: recipe_portion_id
        description: "{{ doc('column__recipe_portion_id') }}"
        data_type: int

      - name: portion_id
        description: "{{ doc('column__portion_id') }}"
        data_type: int

      - name: portion_quantity
        description: "{{ doc('column__portion_quantity') }}"
        data_type: int

      - name: menu_recipe_order
        description: "{{ doc('column__menu_recipe_order') }}"
        data_type: int

      - name: menu_number_days
        description: "{{ doc('column__menu_number_days') }}"
        data_type: int

      - name: language_id
        description: "{{ doc('column__language_id') }}"
        data_type: int

      - name: product_type_id
        description: "{{ doc('column__product_variation_id') }}"
        data_type: string

      - name: product_variation_name
        description: "{{ doc('column__product_variation_name') }}"
        data_type: string

  - name: ml_recipes
    description: "Table containing recipe information with concatenated lists of taxonomies, generic ingredients and recipe\
      \ steps"

    columns:
      - name: fk_dim_companies
        description: "{{ doc('column__pk_dim_companies') }}"
        data_type: string
        constraints:
          - type: not_null
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_companies')
              field: pk_dim_companies

      - name: fk_dim_recipes
        description: "{{ doc('column__pk_dim_recipes') }}"
        data_type: string
        constraints:
          - type: not_null
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_recipes')
              field: pk_dim_recipes

      - name: company_id
        description: "{{ doc('column__company_id') }}"
        data_type: string
        data_tests:
          - not_null

      - name: language_id
        data_type: int
        description: "{{ doc('column__language_id') }}"
        data_tests:
          - not_null

      - name: main_recipe_id
        description: "{{ doc('column__main_recipe_id') }}"
        data_type: int
        data_tests:
          - not_null:
              config:
                severity: warn

      - name: recipe_id
        description: "{{ doc('column__recipe_id') }}"
        data_type: int
        data_tests:
          - unique:
              config:
                severity: warn
          - not_null

      - name: recipe_portion_id
        description: "{{ doc('column__recipe_portion_id') }}"
        data_type: int
        data_tests:
          - not_null:
              config:
                severity: warn

      - name: recipe_name
        description: "{{ doc('column__recipe_name') }}"
        data_type: string

      - name: cooking_time_from
        data_type: int
        description: "{{ doc('column__cooking_time_from') }}"

      - name: cooking_time_to
        data_type: int
        description: "{{ doc('column__cooking_time_to') }}"

      - name: recipe_difficulty_level_id
        data_type: int
        description: "{{ doc('column__recipe_difficulty_level_id') }}"

      - name: recipe_difficulty_name
        description: "{{ doc('column__recipe_difficulty_name') }}"
        data_type: string

      - name: recipe_main_ingredient_id
        data_type: int
        description: "{{ doc('column__recipe_main_ingredient_id') }}"

      - name: recipe_main_ingredient_name_local
        description: "{{ doc('column__recipe_main_ingredient_name_local') }}"
        data_type: string

      - name: taxonomy_list
        data_type: string
        description: "{{ doc('column__taxonomy_list') }}"

      - name: number_of_taxonomies
        data_type: int
        description: "{{ doc('column__number_of_taxonomies') }}"

      - name: generic_ingredient_id_list
        data_type: string
        description: "{{ doc('column__generic_ingredient_id_list') }}"

      - name: number_of_ingredients
        data_type: int
        description: "{{ doc('column__number_of_ingredients') }}"

      - name: recipe_step_id_list
        data_type: string
        description: "{{ doc('column__recipe_step_id_list') }}"

      - name: number_of_recipe_steps
        data_type: int
        description: "{{ doc('column__number_of_recipe_steps') }}"

  - name: estimations_log
    description: Showing what would have been ordered for the next 14 weeks if the cutoff was when the estimation was generated

    columns:
      - name: pk_estimations_log
        description: "{{ doc('column__pk_estimations_log') }}"
        data_type: string
        data_tests:
          - not_null
          - unique

      - name: menu_year
        description: "{{doc('column__menu_year')}}"
        data_type: int - not_null

      - name: menu_week
        description: "{{doc('column__menu_week')}}"
        data_type: int

      - name: company_id
        description: "{{doc('column__company_id')}}"
        data_type: string

      - name: product_variation_id
        description: "{{doc('column__product_variation_id')}}"
        data_type: string

      - name: billing_agreement_basket_deviation_origin_id
        description: "{{doc('column__billing_agreement_basket_deviation_origin_id')}}"
        data_type: string
        data_tests:
          - required_values:
              value_list:
                - '{{ var("normal_origin_id") }}'
                - '{{ var("preselector_origin_id") }}'
                - 00000000-0000-0000-0000-000000000000 # Not deviation

              config:
                where: 'estimation_generated_at >= current_date'

      - name: product_variation_quantity
        description: "{{doc('column__product_variation_quantity')}}"
        data_type: int

      - name: estimation_generated_at
        description: "{{ doc('column__estimation_generated_at') }}"
        data_type: timestamp

      - name: source
        description: "{{ doc('column__source_estimations_log') }}"
        data_type: int

  - name: dishes_order_history
    description: "Table containing aggregated information about the order history for product variations ids"

    columns:
      - name: company_id
        description: "{{ doc('column__company_id') }}"
        data_type: string

      - name: company_name
        description: "{{ doc('column__company_name') }}"
        data_type: string

      - name: menu_year
        description: "{{ doc('column__menu_year') }}"
        data_type: int

      - name: menu_week
        description: "{{ doc('column__menu_week') }}"
        data_type: int

      - name: menu_week_monday_date
        description: "{{ doc('column__menu_week_monday_date') }}"
        data_type: date

      - name: product_variation_id
        description: "{{ doc('column__product_variation_id') }}"
        data_type: string

      - name: product_variation_quantity
        description: "{{ doc('column__product_variation_quantity_order_history') }}"
        data_type: int

      - name: total_weekly_qty
        description: "{{ doc('column__total_weekly_qty') }}"
        data_type: int

      - name: variation_ratio
        description: "{{ doc('column__variation_ratio') }}"
        data_type: double


  - name: ingredients_aggregated_by_recipe_portion_id
    description: "Table with aggregated ingredient information for recipe portion ids"

    columns:
      - name: recipe_portion_id
        description: "{{ doc('column__recipe_portion_id') }}"
        data_type: int

      - name: language_id
        description: "{{ doc('column__language_id') }}"
        data_type: int

      - name: number_generic_ingredients
        description: "{{ doc('column__number_generic_ingredients') }}"
        data_type: int

      - name: generic_ingredient_id_list
        description: "{{ doc('column__generic_ingredient_id_list_per_recipe_portion') }}"
        data_type: string

      - name: generic_ingredient_name_list
        description: "{{ doc('column__generic_ingredient_name_list_per_recipe_portion') }}"
        data_type: string

      - name: ingredient_id_list
        description: "{{ doc('column__ingredient_id_list_per_recipe_portion') }}"
        data_type: string

      - name: ingredient_category_id_list
        description: "{{ doc('column__ingredient_category_id_list_per_recipe_portion') }}"
        data_type: string



  - name: main_recipe_last_menu_year_week
    description: "Table containing the main recipe id and the most recent menu year, week for a billing agreement and company"

    columns:
      - name: billing_agreement_id
        description: "{{ doc('column__billing_agreement_id') }}"
        data_type: int

      - name: company_id
        description: "{{ doc('column__company_id') }}"
        data_type: string

      - name: main_recipe_id
        description: "{{ doc('column__main_recipe_id') }}"
        data_type: int

      - name: most_recent_menu_year_week
        description: "{{ doc('column__most_recent_menu_year_week_main_recipe') }}"
        data_type: int

  - name: preselector_recipes
    description: "Table containing the weekly preselected recipes for billing agreement ids"

    columns:
      - name: menu_week_monday_date
        description: "{{ doc('column__menu_week_monday_date') }}"
        data_type: date

      - name: menu_week
        description: "{{ doc('column__menu_week') }}"
        data_type: int

      - name: menu_year
        description: "{{ doc('column__menu_year') }}"
        data_type: int

      - name: billing_agreement_basket_id
        description: "{{ doc('column__billing_agreement_basket_id') }}"
        data_type: string

      - name: billing_agreement_id
        description: "{{ doc('column__billing_agreement_id') }}"
        data_type: int

      - name: product_variation_id
        description: "{{ doc('column__product_variation_id') }}"
        data_type: string

      - name: deviation_created_at
        description: "{{ doc('column__source_created_at') }}"
        data_type: timestamp

      - name: deviation_created_by
        description: "{{ doc('column__source_created_by') }}"
        data_type: string

      - name: recipe_id
        description: "{{ doc('column__recipe_id') }}"
        data_type: int


  - name: recipe_ingredients
    description: "Table containing ingredient information for recipe portion ids"

    columns:
      - name: recipe_portion_id
        description: "{{ doc('column__recipe_portion_id') }}"
        data_type: int

      - name: generic_ingredient_id
        description: "{{ doc('column__generic_ingredient_id') }}"
        data_type: int

      - name: language_id
        description: "{{ doc('column__language_id') }}"
        data_type: int

      - name: generic_ingredient_name
        description: "{{ doc('column__generic_ingredient_name') }}"
        data_type: string

      - name: order_ingredient_id
        description: "{{ doc('column__order_ingredient_id') }}"
        data_type: int

      - name: ingredient_id
        description: "{{ doc('column__ingredient_id') }}"
        data_type: int

      - name: ingredient_category_id
        description: "{{ doc('column__ingredient_category_id') }}"
        data_type: int

      - name: is_main_carbohydrate
        description: "{{ doc('column__is_main_carbohydrate') }}"
        data_type: boolean

      - name: is_main_protein
        description: "{{ doc('column__is_main_protein') }}"
        data_type: boolean

  - name: ml_recipe_nutritional_facts
    description: "Table containing nutritional facts for recipes"

    columns:
      - name: recipe_id
        description: "{{ doc('column__recipe_id') }}"
        data_type: int
        tests:
          - not_null

      - name: recipe_name
        description: "{{ doc('column__recipe_name') }}"
        data_type: string

      - name: recipe_portion_id
        description: "{{ doc('column__recipe_portion_id') }}"
        data_type: int

      - name: language_id
        description: "{{ doc('column__language_id') }}"
        data_type: int

      - name: portion_size
        description: "{{ doc('column__portion_size') }}"
        data_type: int

      - name: protein_gram_per_portion
        description: "{{ doc('column__protein_gram_per_portion') }}"
        data_type: float

      - name: carbs_gram_per_portion
        description: "{{ doc('column__carbs_gram_per_portion') }}"
        data_type: float

      - name: fat_gram_per_portion
        description: "{{ doc('column__fat_gram_per_portion') }}"
        data_type: float

      - name: sat_fat_gram_per_portion
        description: "{{ doc('column__sat_fat_gram_per_portion') }}"
        data_type: float

      - name: sugar_gram_per_portion
        description: "{{ doc('column__sugar_gram_per_portion') }}"
        data_type: float

      - name: sugar_added_gram_per_portion
        description: "{{ doc('column__sugar_added_gram_per_portion') }}"
        data_type: float

      - name: fiber_gram_per_portion
        description: "{{ doc('column__fiber_gram_per_portion') }}"
        data_type: float

      - name: salt_gram_per_portion
        description: "{{ doc('column__salt_gram_per_portion') }}"
        data_type: float

      - name: salt_added_gram_per_portion
        description: "{{ doc('column__salt_added_gram_per_portion') }}"
        data_type: float

      - name: fg_fresh_gram_per_portion
        description: "{{ doc('column__fg_fresh_gram_per_portion') }}"
        data_type: float

      - name: fg_proc_gram_per_portion
        description: "{{ doc('column__fg_proc_gram_per_portion') }}"
        data_type: float

      - name: total_kcal_per_portion
        description: "{{ doc('column__total_kcal_per_portion') }}"
        data_type: float

  - name: ml_recipe_tagging
    description: "Table containing data for the recipe tagging project"

    columns:
      - name: recipe_id
        description: "{{ doc('column__recipe_id') }}"
        data_type: int

      - name: recipe_name
        description: "{{ doc('column__recipe_name') }}"
        data_type: string

      - name: recipe_main_ingredient_name_local
        description: "{{ doc('column__recipe_main_ingredient_name_local') }}"
        data_type: string

      - name: language_id
        description: "{{ doc('column__language_id') }}"
        data_type: int

      - name: cooking_time_to
        description: "{{ doc('column__cooking_time_to') }}"
        data_type: int

      - name: taxonomy_name_list
        description: "{{ doc('column__taxonomy_list') }}"
        data_type: string

      - name: generic_ingredient_name_list
        description: "{{ doc('column__generic_ingredient_name_list_per_recipe_portion') }}"
        data_type: string

      - name: preference_name_combinations
        description: "{{ doc('column__preference_name_combinations') }}"
        data_type: string

      - name: is_low_calorie
        description: "{{ doc('column__is_low_calorie') }}"
        data_type: boolean

      - name: is_high_fiber
        description: "{{ doc('column__is_high_fiber') }}"
        data_type: boolean

      - name: is_low_fat
        description: "{{ doc('column__is_low_fat') }}"
        data_type: boolean

      - name: is_low_sugar
        description: "{{ doc('column__is_low_sugar') }}"
        data_type: boolean

  - name: active_basket_deviations_recent_weeks
    description: "Table containing current active basket deviations for recent and all future menu weeks"
    meta:
      owners:
        - "matsmoll"
        - "stephen"

    columns:
      - name: billing_agreement_id
        description: "{{ doc('column__billing_agreement_id') }}"
        data_type: int
        data_tests:
          - not_null

      - name: company_id
        description: "{{ doc('column__company_id') }}"
        data_type: string
        data_tests:
          - not_null

      - name: menu_week_monday_date
        description: "{{ doc('column__menu_week_monday_date') }}"
        data_type: date
        data_tests:
          - not_null

      - name: menu_week
        description: "{{ doc('column__menu_week') }}"
        data_type: int
        data_tests:
          - not_null

      - name: menu_year
        description: "{{ doc('column__menu_year') }}"
        data_type: int
        data_tests:
          - not_null

      - name: main_recipe_id
        description: "{{ doc('column__main_recipe_id') }}"
        data_type: int
        data_tests:
          - not_null

      - name: recipe_name
        description: "{{ doc('column__recipe_name') }}"
        data_type: string
        data_tests:
          - not_null

      - name: deviation_created_at
        description: "{{ doc('column__source_created_at') }}"
        data_type: timestamp
        data_tests:
          - not_null
