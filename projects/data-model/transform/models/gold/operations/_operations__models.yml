version: 2

models:
  - name: dim_transportation
    description: >
      Contains information about the transportation of a delivery including transport company and the facilities distributing the boxes.
    latest_version: 1
    config:
      alias: dim_transportation
      contract:
        enforced: true

    columns:
      - name: pk_dim_transportation
        data_type: string
        description: "{{ doc('column__pk_dim_transportation') }}"
        constraints:
          - type: primary_key
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: zone_id
        data_type: int
        description: "{{ doc('column__zone_id') }}"
        data_tests:
          - unique
          - not_null

      - name: transport_company_id
        data_type: int
        description: "{{ doc('column__transport_company_id') }}"
        data_tests:
          - not_null

      - name: last_mile_hub_distribution_center_id
        data_type: char(36)
        description: "{{ doc('column__distribution_center_id') }}"

      - name: packing_distribution_center_id
        data_type: char(36)
        description: "{{ doc('column__distribution_center_id') }}"

      - name: transport_company_name
        data_type: varchar(100)
        description: "{{ doc('column__transport_company_name') }}"

      - name: last_mile_distribution_site
        data_type: string
        description: "{{ doc('column__last_mile_distribution_site') }}"

      - name: last_mile_distribution_postal_code
        data_type: string
        description: "{{ doc('column__postal_code') }}"

      - name: last_mile_distribution_longitude
        data_type: decimal(9,6)
        description: "{{ doc('column__longitude') }}"

      - name: last_mile_distribution_latitude
        data_type: decimal(9,6)
        description: "{{ doc('column__latitude') }}"

      - name: production_site
        data_type: string
        description: "{{ doc('column__production_site') }}"
      
    versions:
      - v: 1

  - name: dim_case_details
    description: >
      Contains information about cause, category, type, and responsible party for a case line related to a delivery. 
      A case can be reported by the customer, customer service or a partner. One order can only have one case, but 
      a case can have several case lines.
    latest_version: 1
    config:
      alias: dim_case_details
      contract:
        enforced: true

    columns:
      - name: pk_dim_case_details
        data_type: string
        description: "{{ doc('column__pk_dim_case_details') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: case_category_id
        data_type: string
        description: "{{ doc('column__case_category_id') }}"

      - name: case_category_name
        data_type: string
        description: "{{ doc('column__case_category_name') }}"

      - name: case_impact_id
        data_type: string
        description: "{{ doc('column__case_impact_id') }}"

      - name: case_cause_name
        data_type: string
        description: "{{ doc('column__case_cause_name_dim') }}"

      - name: case_impact
        data_type: string
        description: "{{ doc('column__case_impact') }}"

      - name: case_cause_responsible_id
        data_type: string
        description: "{{ doc('column__case_cause_responsible_id') }}"

      - name: case_responsibility_type
        data_type: string
        description: "{{ doc('column__case_responsibility_type') }}"

      - name: case_line_type_id
        data_type: int
        description: "{{ doc('column__case_line_type_id') }}"
        data_tests:
          - not_null

      - name: case_line_type_name
        data_type: string
        description: "{{ doc('column__case_line_type_name') }}"
      
      - name: taxonomy_id
        data_type: string
        description: "{{ doc('column__taxonomy_id_operations') }}"
      
      - name: taxonomy_name
        data_type: string
        description: "{{ doc('column__taxonomy_name_operations') }}"

    versions:
      - v: 1

  - name: fact_cases
    description: >
      Cases and case lines reltated to deliveries reported by the customer, customer service or partners.
      A case line includes communication records (SMS and notes), redelivery events, and complaints with reimbursement options.
      A delivery can only have one related case, but a case can have several case lines. 
    latest_version: 1
    config:
      alias: fact_cases
      contract:
        enforced: true

    columns:
      - name: pk_fact_cases
        data_type: string
        description: "{{ doc('column__pk_fact_cases') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: case_id
        data_type: char(36)
        description: "{{ doc('column__case_id') }}"

      - name: case_line_id
        data_type: varchar(36)
        description: "{{ doc('column__case_line_id') }}"

      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_order_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_order_id') }}"

      - name: ops_order_id
        data_type: bigint
        description: "{{ doc('column__ops_order_id') }}"
        data_tests:
          - not_null

      - name: credit_amount_ex_vat
        data_type: double
        description: "{{ doc('column__credit_amount_ex_vat') }}"

      - name: credit_amount_inc_vat
        data_type: double
        description: "{{ doc('column__credit_amount_inc_vat') }}"

      - name: case_line_ingredient_amount_inc_vat
        data_type: decimal(38,9)
        description: "{{ doc('column__case_line_ingredient_amount_inc_vat') }}"

      - name:  case_line_ingredient_amount_share
        data_type: double
        description: "{{ doc('column__case_line_ingredient_amount_share') }}"

      - name: case_line_total_amount_inc_vat
        data_type: decimal(19,4)
        description: "{{ doc('column__case_line_total_amount_inc_vat') }}"

      - name: case_line_comment
        data_type: string
        description: "{{ doc('column__case_line_comment') }}"

      - name: case_line_type_id
        data_type: int
        description: "{{ doc('column__case_line_type_id') }}"

      - name: case_cause_id
        data_type: string
        description: "{{ doc('column__case_cause_id') }}"

      - name: case_responsible_id
        data_type: string
        description: "{{ doc('column__case_responsible_id') }}"

      - name: case_category_id
        data_type: string
        description: "{{ doc('column__case_category_id') }}"

      - name: case_impact_id
        data_type: string
        description: "{{ doc('column__case_impact_id') }}"

      - name: case_cause_responsible_id
        data_type: string
        description: "{{ doc('column__case_cause_responsible_id') }}"

      - name: taxonomy_id
        data_type: string
        description: "{{ doc('column__taxonomy_id_operations') }}"

      - name: case_status_id
        data_type: int
        description: "{{ doc('column__case_status_id') }}"
        data_tests:
          - not_null
  
      - name: ingredient_id
        data_type: int
        description: "{{ doc('column__ingredient_id') }}"

      - name: product_type_id
        data_type: string
        description: "{{ doc('column__product_type_id') }}"

      - name: language_id
        description: "{{ doc('column__language_id') }}"
        data_type: int
        data_tests:
          - not_null

      - name: redelivery_timeblock_id
        data_type: int
        description: "{{ doc('column__redelivery_timeblock_id') }}"

      - name: redelivery_status_id
        data_type: int
        description: "{{ doc('column__redelivery_status_id') }}"
        data_tests:
          - not_null

      - name: ingredient_price
        data_type: decimal(18,0)
        description: "{{ doc('column__ingredient_price') }}"

      - name: ingredient_quantity
        data_type: int
        description: "{{ doc('column__ingredient_quantity_case') }}"

      - name: is_complaint
        data_type: boolean
        description: "{{ doc('column__is_complaint') }}"
        data_tests:
          - not_null

      - name: is_accepted_redelivery
        data_type: boolean
        description: "{{ doc('column__is_accepted_redelivery') }}"
        data_tests:
          - not_null

      - name: is_active_case_line
        data_type: boolean
        description: "{{ doc('column__is_active_case_line') }}"
        data_tests:
          - not_null

      - name: ingredient_internal_reference
        data_type: string
        description: "{{ doc('column__ingredient_internal_reference') }}"

      - name: redelivery_comment
        data_type: string
        description: "{{ doc('column__redelivery_comment') }}"

      - name: redelivery_user
        data_type: string
        description: "{{ doc('column__redelivery_comment') }}"

      - name: menu_year
        data_type: int
        description: "{{ doc('column__menu_year') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null
  
      - name: menu_week
        data_type: int
        description: "{{ doc('column__menu_week') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: menu_week_financial_date
        data_type: date
        description: "{{ doc('column__menu_week_financial_date') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: redelivery_at
        data_type: timestamp
        description: "{{ doc('column__redelivery_at') }}"

      - name: case_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null

      - name: case_line_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null

      - name: fk_dim_billing_agreements
        data_type: string
        description: "{{ doc('column__pk_dim_billing_agreements') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_billing_agreements')
            to_columns: [pk_dim_billing_agreements]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_billing_agreements')
              field: pk_dim_billing_agreements
              config:
                where: "fk_dim_billing_agreements != 0"

      - name: fk_dim_companies
        data_type: string
        description: "{{ doc('column__pk_dim_companies') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_companies')
            to_columns: [pk_dim_companies]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_companies')
              field: pk_dim_companies

      - name: fk_dim_case_details
        data_type: string
        description: "{{ doc('column__pk_dim_case_details') }}"
        constraints:
          - type: foreign_key
            to: ref('dim_case_details')
            to_columns: [pk_dim_case_details]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_case_details')
              field: pk_dim_case_details

      - name: fk_dim_customer_journey_segments
        data_type: string
        description: "{{ doc('column__pk_dim_customer_journey_segments') }}"
        constraints:
          - type: foreign_key
            to: ref('dim_customer_journey_segments')
            to_columns: [pk_dim_customer_journey_segments]
        data_tests:
          - relationships:
              to: ref('dim_customer_journey_segments')
              field: pk_dim_customer_journey_segments

      - name: fk_dim_dates
        data_type: int
        description: "{{ doc('column__pk_dim_dates') }}"
        constraints:
          - type: foreign_key
            to: ref('dim_dates')
            to_columns: [pk_dim_dates]
          - type: not_null
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: pk_dim_dates
    
      - name: fk_dim_ingredients
        data_type: string
        description: "{{ doc('column__pk_dim_ingredients') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_ingredients')
            to_columns: [pk_dim_ingredients]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_ingredients')
              field: pk_dim_ingredients
              config:
                where: "fk_dim_ingredients != 0"

      - name: fk_dim_transportation
        data_type: string
        description: "{{ doc('column__pk_dim_transportation') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_transportation')
            to_columns: [pk_dim_transportation]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_transportation')
              field: pk_dim_transportation

    versions:
      - v: 1
