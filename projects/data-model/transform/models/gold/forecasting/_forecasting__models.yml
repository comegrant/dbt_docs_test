  models:
  - name: fact_estimations
    description: "Table of all estimations at each timestamp they're generated. The estimations are a snapshot of the active baskets at the time of generation, and is generated in the Data Platform."
    latest_version: 1
    config:
      alias: fact_estimations
      config:
        enforced: true

    columns:
      - name: pk_fact_estimations
        data_type: string
        description: "{{ doc('column__pk_fact_estimations') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: menu_year
        data_type: int
        description: "{{ doc('column__menu_year') }}"
        data_tests:
          - not_null

      - name: menu_week
        data_type: int
        description: "{{ doc('column__menu_week') }}"
        data_tests:
          - not_null

      - name: menu_week_monday_date
        data_type: date
        description: "{{ doc('column__menu_week_monday_date') }}"
        data_tests:
          - not_null

      - name: menu_week_financial_date
        data_type: date
        description: "{{ doc('column__menu_week_financial_date') }}"
        data_tests:
          - not_null

      - name: company_id
        data_type: string
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: varchar(36)
        description: "{{ doc('column__product_variation_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_basket_deviation_origin_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        data_tests:
          - not_null

      - name: estimation_generated_at
        data_type: timestamp
        description: "{{ doc('column__estimation_generated_at') }}"
        data_tests:
          - not_null

      - name: shipping_address_id
        data_type: string
        description: "{{ doc('column__shipping_address_id') }}"
      
      - name: postal_code
        data_type: string
        description: "{{ doc('column__postal_code_shipping_address') }}"

      - name: product_variation_quantity
        data_type: int
        description: "{{ doc('column__estimations_product_variation_quantity') }}"
        data_tests:
          - not_null

      - name: is_latest_estimation
        data_type: boolean
        description: "{{ doc('column__is_latest_estimation') }}"
        data_tests:
          - not_null

      - name: fk_dim_date_estimation_generated
        datatype: bigint
        description: "{{ doc('column__fk_dim_date_estimation_generated') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: pk_dim_dates


      - name: fk_dim_time_estimation_generated
        datatype: bigint
        description: "{{ doc('column__fk_dim_time_estimation_generated') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_time')
              field: pk_dim_time

      - name: fk_dim_date_menu_week
        datatype: int
        description: "{{ doc('column__fk_dim_date_menu_week') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: pk_dim_dates

      - name: fk_dim_companies
        data_type: string
        description: "{{ doc('column__pk_dim_companies') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_companies')
              field: pk_dim_companies

      - name: fk_dim_products
        data_type: string
        description: "{{ doc('column__pk_dim_products') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_products')
              field: pk_dim_products

      - name: fk_dim_basket_deviation_origins
        data_type: string
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_basket_deviation_origins')
              field: pk_dim_basket_deviation_origins

      - name: fk_dim_billing_agreements
        data_type: string
        description: "{{ doc('column__pk_dim_billing_agreements') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_billing_agreements')
              field: pk_dim_billing_agreements

      - name: fk_dim_preference_combinations
        data_type: string
        description: "{{ doc('column__pk_dim_preference_combinations') }}"
        data_tests:
          - relationships:
              to: ref('dim_preference_combinations')
              field: pk_dim_preference_combinations

      - name: fk_dim_portions
        data_type: string
        description: "{{ doc('column__pk_dim_portions') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_portions')
              field: pk_dim_portions

      - name: fk_dim_addresses
        data_type: string
        description: "{{ doc('column__pk_dim_addresses') }}"

    versions:
      - v: 1


  - name: dim_basket_deviation_origins
    description: Dimension table for basket deviation origins
    latest_version: 1
    config:
      alias: dim_basket_deviation_origins
      contract:
        enforced: true

    columns:
      - name: pk_dim_basket_deviation_origins
        data_type: string
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_basket_deviation_origin_id
        data_type: string
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        data_tests:
          - not_null
          - unique

      - name: basket_deviation_origin_name
        data_type: string
        description: "{{ doc('column__basket_deviation_origin_name') }}"
        data_tests:
          - not_null

      - name: basket_deviation_origin_source_name
        data_type: string
        description: "{{ doc('column__basket_deviation_origin_source_name') }}"
        data_tests:
          - not_null

      - name: preselector_category
        data_type: string
        description: "{{ doc('column__preselector_category') }}"
        data_tests:
          - not_null

    versions:
      - v: 1

  - name: dim_budget_types
    description: "Contain all ids, names and descriptions of budget attributes"
    latest_version: 1
    config:
      alias: dim_budget_types
      contract:
        enforced: true

    columns:
      - name: pk_dim_budget_types
        data_type: string
        description: "{{ doc('column__pk_dim_budget_types') }}"
        data_tests:
          - unique
          - not_null

      - name: budget_type_id
        data_type: string
        description: "{{ doc('column__budget_type_id') }}"
        data_tests:
          - not_null

      - name: budget_type_name
        data_type: string
        description: "{{ doc('column__budget_type_name') }}"
        data_tests:
          - not_null

      - name: budget_type_description
        data_type: string
        description: "{{ doc('column__budget_type_description') }}"
        data_tests:
          - not_null

    versions:
      - v: 1


  - name: fact_budget
    description: "Table containing budget numbers, budget dates and id's"
    latest_version: 1
    config:
      alias: fact_budget
      contract:
        enforced: true

    columns:
      - name: pk_fact_budget
        data_type: string
        description: "{{ doc('column__pk_fact_budget') }}"
        data_tests:
          - unique
          - not_null

      - name: budget_id
        data_type: string
        description: "{{ doc('column__budget_id') }}"
        data_tests:
          - not_null

      - name: budget_type_id
        data_type: string
        description: "{{ doc('column__budget_type_id') }}"
        data_tests:
          - not_null

      - name: budget_segment_id
        data_type: string
        description: ""
        data_tests:
          - not_null

      - name: company_id
        data_type: string
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: financial_year
        data_type: int
        description: "{{ doc('column__financial_year') }}"
        data_tests:
          - not_null

      - name: financial_week
        data_type: int
        description: "{{ doc('column__financial_week') }}"
        data_tests:
          - not_null

      - name: budget_atv_gross_ex_vat
        data_type: decimal(19,4)
        description: "{{ doc('column__budget_atv_gross_ex_vat') }}"
        data_tests:
          - not_null

      - name: budget_order_value_gross_ex_vat
        data_type: decimal(19,4)
        description: "{{ doc('column__budget_order_value_gross_ex_vat') }}"
        data_tests:
          - not_null

      - name: budget_number_of_orders
        data_type: int
        description: "{{ doc('column__budget_number_of_orders') }}"
        data_tests:
          - not_null

      - name: fk_dim_dates
        data_type: int
        description: "{{ doc('column__pk_dim_dates') }}"
        data_tests:
          - not_null

      - name: fk_dim_companies
        data_type: string
        description: "{{ doc('column__pk_dim_companies') }}"
        data_tests:
          - not_null

      - name: fk_dim_budget_types
        data_type: string
        description: "{{ doc('column__pk_dim_budget_types') }}"
        data_tests:
          - not_null
    versions:
      - v: 1
