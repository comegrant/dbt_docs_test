  models:
  - name: fact_estimations
    description: "Table of the latest estimations for each company. The estimations are a snapshot of the active baskets at the time of generation, and is generated in the Data Platform."
    latest_version: 1
    config:
      alias: fact_estimations
      config:
        enforced: true

    columns:
      - name: pk_fact_estimations
        data_type: string
        description: "{{ doc('column__pk_fact_estimations') }}"
        constraints:
          - type: primary_key
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: menu_year
        data_type: int
        description: "{{ doc('column__menu_year') }}"
        data_tests:
          - not_null

      - name: menu_week
        data_type: int
        description: "{{ doc('column__menu_week') }}"
        data_tests:
          - not_null

      - name: menu_week_monday_date
        data_type: date
        description: "{{ doc('column__menu_week_monday_date') }}"
        data_tests:
          - not_null

      - name: menu_week_financial_date
        data_type: date
        description: "{{ doc('column__menu_week_financial_date') }}"
        data_tests:
          - not_null

      - name: company_id
        data_type: string
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: varchar(36)
        description: "{{ doc('column__product_variation_id') }}"
        data_tests:
          - not_null

      - name: is_mealbox
        data_type: boolean
        description: "{{ doc('column__is_mealbox') }}"

      - name: is_dish
        data_type: boolean
        description: "{{ doc('column__is_dish') }}"

      - name: is_grocery
        data_type: boolean
        description: "{{ doc('column__is_grocery') }}"

      - name: billing_agreement_basket_deviation_origin_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        data_tests:
          - not_null

      - name: estimation_generated_at
        data_type: timestamp
        description: "{{ doc('column__estimation_generated_at') }}"
        data_tests:
          - not_null

      - name: shipping_address_id
        data_type: string
        description: "{{ doc('column__shipping_address_id') }}"

      - name: postal_code
        data_type: string
        description: "{{ doc('column__postal_code_shipping_address') }}"

      - name: product_variation_quantity
        data_type: int
        description: "{{ doc('column__estimations_product_variation_quantity') }}"
        data_tests:
          - not_null

      - name: fk_dim_date_estimation_generated
        datatype: bigint
        description: "{{ doc('column__fk_dim_date_estimation_generated') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: pk_dim_dates


      - name: fk_dim_time_estimation_generated
        datatype: bigint
        description: "{{ doc('column__fk_dim_time_estimation_generated') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_time')
              field: pk_dim_time

      - name: fk_dim_dates_menu_week
        datatype: int
        description: "{{ doc('column__fk_dim_dates_menu_week') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: pk_dim_dates

      - name: fk_dim_companies
        data_type: string
        description: "{{ doc('column__pk_dim_companies') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_companies')
              field: pk_dim_companies

      - name: fk_dim_products
        data_type: string
        description: "{{ doc('column__pk_dim_products') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_products')
              field: pk_dim_products

      - name: fk_dim_basket_deviation_origins
        data_type: string
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_basket_deviation_origins')
              field: pk_dim_basket_deviation_origins

      - name: fk_dim_billing_agreements
        data_type: string
        description: "{{ doc('column__pk_dim_billing_agreements') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_billing_agreements')
              field: pk_dim_billing_agreements

      - name: fk_dim_preference_combinations
        data_type: string
        description: "{{ doc('column__pk_dim_preference_combinations') }}"
        data_tests:
          - relationships:
              to: ref('dim_preference_combinations')
              field: pk_dim_preference_combinations

      - name: fk_dim_portions
        data_type: string
        description: "{{ doc('column__pk_dim_portions') }}"
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_portions')
              field: pk_dim_portions

      - name: fk_dim_addresses
        data_type: string
        description: "{{ doc('column__pk_dim_addresses') }}"

    versions:
      - v: 1


  - name: dim_basket_deviation_origins
    description: Dimension table for basket deviation origins
    latest_version: 1
    config:
      alias: dim_basket_deviation_origins
      contract:
        enforced: true

    columns:
      - name: pk_dim_basket_deviation_origins
        data_type: string
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        constraints:
          - type: primary_key
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_basket_deviation_origin_id
        data_type: string
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        data_tests:
          - not_null
          - unique

      - name: basket_deviation_origin_name
        data_type: string
        description: "{{ doc('column__basket_deviation_origin_name') }}"
        data_tests:
          - not_null

      - name: basket_deviation_origin_source_name
        data_type: string
        description: "{{ doc('column__basket_deviation_origin_source_name') }}"
        data_tests:
          - not_null

      - name: preselector_category
        data_type: string
        description: "{{ doc('column__preselector_category') }}"
        data_tests:
          - not_null

    versions:
      - v: 1

  - name: dim_budget_types
    description: "Contain all ids, names and descriptions of budget attributes"
    latest_version: 1
    config:
      alias: dim_budget_types
      contract:
        enforced: true

    columns:
      - name: pk_dim_budget_types
        data_type: string
        description: "{{ doc('column__pk_dim_budget_types') }}"
        data_tests:
          - unique
          - not_null

      - name: budget_type_id
        data_type: string
        description: "{{ doc('column__budget_type_id') }}"
        data_tests:
          - not_null

      - name: budget_type_name
        data_type: string
        description: "{{ doc('column__budget_type_name') }}"
        data_tests:
          - not_null

      - name: budget_type_description
        data_type: string
        description: "{{ doc('column__budget_type_description') }}"
        data_tests:
          - not_null

    versions:
      - v: 1


  - name: fact_budget
    description: "Table containing budget numbers, budget dates and id's"
    latest_version: 1
    config:
      alias: fact_budget
      contract:
        enforced: true

    columns:
      - name: pk_fact_budget
        data_type: string
        description: "{{ doc('column__pk_fact_budget') }}"
        data_tests:
          - unique
          - not_null

      - name: budget_id
        data_type: string
        description: "{{ doc('column__budget_id') }}"
        data_tests:
          - not_null

      - name: budget_type_id
        data_type: string
        description: "{{ doc('column__budget_type_id') }}"
        data_tests:
          - not_null

      - name: budget_segment_id
        data_type: string
        description: ""
        data_tests:
          - not_null

      - name: company_id
        data_type: string
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: financial_year
        data_type: int
        description: "{{ doc('column__financial_year') }}"
        data_tests:
          - not_null

      - name: financial_week
        data_type: int
        description: "{{ doc('column__financial_week') }}"
        data_tests:
          - not_null

      - name: budget_atv_gross_ex_vat
        data_type: decimal(19,4)
        description: "{{ doc('column__budget_atv_gross_ex_vat') }}"
        data_tests:
          - not_null

      - name: budget_order_value_gross_ex_vat
        data_type: decimal(19,4)
        description: "{{ doc('column__budget_order_value_gross_ex_vat') }}"
        data_tests:
          - not_null

      - name: budget_number_of_orders
        data_type: int
        description: "{{ doc('column__budget_number_of_orders') }}"
        data_tests:
          - not_null

      - name: fk_dim_dates
        data_type: int
        description: "{{ doc('column__pk_dim_dates') }}"
        data_tests:
          - not_null

      - name: fk_dim_companies
        data_type: string
        description: "{{ doc('column__pk_dim_companies') }}"
        data_tests:
          - not_null

      - name: fk_dim_budget_types
        data_type: string
        description: "{{ doc('column__pk_dim_budget_types') }}"
        data_tests:
          - not_null
    versions:
      - v: 1

  - name: fact_forecast_variations
    description: "All forecasts per forecast group, product variation and menu week produced by the analytics team and including overwrites made by external teams."
    config:
      alias: fact_forecast_variations
      contract:
        enforced: true

    columns:
      - name: pk_fact_forecast_variations
        data_type: string
        description: "{{ doc('column__pk_fact_forecast_variations') }}"
        constraints:
          - type: primary_key
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: forecast_job_run_id
        data_type: string
        description: "{{ doc('column__forecast_job_run_id') }}"
        data_tests:
          - not_null

      - name: forecast_job_id
        data_type: string
        description: "{{ doc('column__forecast_job_id') }}"
        data_tests:
          - not_null

      - name: company_id
        data_type: string
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: menu_year
        data_type: int
        description: "{{ doc('column__menu_year') }}"
        data_tests:
          - not_null

      - name: menu_week
        data_type: int
        description: "{{ doc('column__menu_week') }}"
        data_tests:
          - not_null

      - name: forecast_group_id
        data_type: string
        description: "{{ doc('column__forecast_group_id') }}"
        data_tests:
          - not_null

      - name: forecast_model_id
        data_type: string
        description: "{{ doc('column__forecast_model_id') }}"
        data_tests:
          - not_null

      - name: forecast_horizon_index
        data_type: int
        description: "{{ doc('column__forecast_horizon_index') }}"
        data_tests:
          - not_null

      - name: forecast_horizon
        data_type: int
        description: "{{ doc('column__forecast_horizon') }}"
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: string
        description: "{{ doc('column__product_variation_id') }}"
        data_tests:
          - not_null

      - name: recipe_id
        data_type: int
        description: "{{ doc('column__recipe_id') }}"

      - name: portion_id
        data_type: int
        description: "{{ doc('column__portion_id') }}"

      - name: language_id
        data_type: int
        description: "{{ doc('column__language_id') }}"

      - name: is_dish
        data_type: boolean
        description: "{{ doc('column__is_dish') }}"

      - name: is_grocery
        data_type: boolean
        description: "{{ doc('column__is_grocery') }}"

      - name: ingredient_combination_id
        data_type: string
        description: "{{ doc('column__ingredient_combination_id') }}"

      - name: product_variation_quantity_forecast_analytics
        data_type: int
        description: "{{ doc('column__product_variation_quantity_forecast_analytics') }}"

      - name: product_variation_quantity_forecast
        data_type: int
        description: "{{ doc('column__product_variation_quantity_forecast') }}"

      - name: order_quantity_forecast
        data_type: int
        description: "{{ doc('column__order_quantity_forecast') }}"

      - name: forecast_generated_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: is_most_recent_menu_week_horizon_forecast
        data_type: boolean
        description: "{{ doc('column__is_most_recent_menu_week_horizon_forecast') }}"
        data_tests:
          - not_null

      - name: is_most_recent_menu_week_forecast
        data_type: boolean
        description: "{{ doc('column__is_most_recent_menu_week_forecast') }}"
        data_tests:
          - not_null

      - name: fk_dim_companies
        data_type: string
        description: "{{ doc('column__pk_dim_companies') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_companies')
            to_columns: [pk_dim_companies]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_companies')
              field: pk_dim_companies

      - name: fk_dim_products
        data_type: string
        description: "{{ doc('column__pk_dim_products') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_products')
            to_columns: [pk_dim_products]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_products')
              field: pk_dim_products

      - name: fk_dim_dates_menu_week
        data_type: int
        description: "{{ doc('column__fk_dim_dates_menu_week') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_dates')
            to_columns: [pk_dim_dates]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: pk_dim_dates

      - name: fk_dim_dates_forecast_generated_at
        data_type: int
        description: "{{ doc('column__fk_dim_dates_forecast_generated_at') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_dates')
            to_columns: [pk_dim_dates]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_dates')
              field: pk_dim_dates

      - name: fk_dim_recipes
        data_type: string
        description: "{{ doc('column__pk_dim_recipes') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_recipes')
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_recipes')
              field: pk_dim_recipes

      - name: fk_dim_portions
        data_type: string
        description: "{{ doc('column__pk_dim_portions') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_portions')
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_portions')
              field: pk_dim_portions

      - name: fk_dim_ingredient_combinations
        data_type: string
        description: "{{ doc('column__pk_dim_ingredient_combinations') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_ingredient_combinations')
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_ingredient_combinations')
              field: pk_dim_ingredient_combinations

      - name: fk_dim_forecast_runs
        data_type: string
        description: "{{ doc('column__pk_dim_forecast_runs') }}"
        constraints:
          - type: not_null
          - type: foreign_key
            to: ref('dim_forecast_runs')
            to_columns: [pk_dim_forecast_runs]
        data_tests:
          - not_null
          - relationships:
              to: ref('dim_forecast_runs')
              field: pk_dim_forecast_runs

  - name: dim_forecast_runs
    description: "Contains all combinations of jobs, forecast groups, forecast models, forecast_horizon_index and forecast_horizon that produce forecasts."
    config:
      alias: dim_forecast_runs
      contract:
        enforced: true

    columns:
      - name: pk_dim_forecast_runs
        data_type: string
        description: "{{ doc('column__pk_dim_forecast_runs') }}"
        constraints:
          - type: primary_key
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: forecast_job_id
        data_type: string
        description: "{{ doc('column__forecast_job_id') }}"
        data_tests:
          - not_null

      - name: company_id
        data_type: string
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: forecast_group_id
        data_type: string
        description: "{{ doc('column__forecast_group_id') }}"
        data_tests:
          - not_null

      - name: forecast_model_id
        data_type: string
        description: "{{ doc('column__forecast_model_id') }}"
        data_tests:
          - not_null

      - name: forecast_horizon_index
        data_type: int
        description: "{{ doc('column__forecast_horizon_index') }}"
        data_tests:
          - not_null

      - name: forecast_horizon
        data_type: int
        description: "{{ doc('column__forecast_horizon') }}"
        data_tests:
          - not_null
      
      - name: forecast_horizon_group
        data_type: string
        description: "{{ doc('column__forecast_horizon_group') }}"
        data_tests:
          - not_null

      - name: forecast_job_name
        data_type: string
        description: "{{ doc('column__forecast_job_name') }}"
        data_tests:
          - not_null

      - name: forecast_group_name
        data_type: string
        description: "{{ doc('column__forecast_group_name') }}"
        data_tests:
          - not_null

      - name: forecast_model_name
        data_type: string
        description: "{{ doc('column__forecast_model_name') }}"
        data_tests:
          - not_null
