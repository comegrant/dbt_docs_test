# DOUCMENTATION: https://docs.getdbt.com/reference/model-properties

version: 2

models:
  - name: analyticsdb_analytics__billing_agreement_basket_products_log
    description: "Log table of basket products from AnalyticsDB. Was run before every cutoff."
    columns:
      - name: billing_agreement_basket_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_id') }}"
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: varchar(36)
        description: "{{ doc('column__product_variation_id') }}"
        data_tests:
          - not_null

      - name: product_delivery_week_type_id
        data_type: int
        description: "{{ doc('column__delivery_week_type_id') }}"
        data_tests:
          - not_null

      - name: product_variation_quantity
        data_type: int
        description: "{{ doc('column__product_variation_quantity') }}"
        data_tests:
          - not_null

      - name: is_extra_product
        data_type: boolean
        description: "{{ doc('column__is_extra_basket_product') }}"

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null
  
  - name: analyticsdb_snapshots__historical_billing_agreement_statuses
    description: "A daily snapshot table of billing_agreement_ids with statuses from AnalyticsDB. Deleted agreements are not included."
    columns:
      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: billing_agreement_status_id
        data_type: int
        description: "{{ doc('column__billing_agreement_status_id') }}"
        constraints:
          - type: not_null
 
      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

  - name: analyticsdb_orders__historical_orders_combined
    description: "Historical orders for Linas, GodtLevert, Adams and RetNemt stored in AnalyticsDB (previous database for analytics)."
    columns:
      - name: ops_order_id
        data_type: string
        description: "{{ doc('column__ops_order_id') }}"
        data_tests:
          - unique

      - name: order_type_id
        data_type: varchar(36)
        description: "{{ doc('column__order_type_id') }}"
        data_tests:
          - not_null

      - name: order_status_id
        data_type: varchar(36)
        description: "{{ doc('column__order_status_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        data_tests:
          - not_null

      - name: delivery_date
        data_type: date
        description: "The delivery date of the order. Only used for debugging purposes."
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null
  
  - name: analyticsdb_orders__historical_order_lines_combined
    description: "Historical order lines stored in AnalyticsDB (old analytics database). Not complete and needs to be combined with other tables from AnalyticsDB."
    columns:
      - name: billing_agreement_order_line_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_order_line_id') }}"
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_order_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_order_id') }}"
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: varchar(36)
        description: "{{ doc('column__product_variation_id') }}"
        data_tests:
          - not_null

      - name: order_line_type_name
        data_type: string
        description: "{{ doc('column__order_line_type_name') }}"
        data_tests:
          - not_null
          - accepted_values:
              values: [
                  'CREDIT', 
                  'PRP', 
                  'P4P', 
                  'DISCOUNT', 
                  'DISCOUNT_GIFT', 
                  'INVOICE', 
                  'DEBIT', 
                  'TRANSPORT', 
                  'LOYALTY_CREDIT', 
                  'DEBIT_GIFT'
              ]
              
      - name: product_variation_quantity
        data_type: int
        description: "{{ doc('column__product_variation_quantity') }}"
        data_tests:
          - not_null

      - name: vat
        data_type: decimal(10,8)
        description: "{{ doc('column__vat') }}"
        data_tests:
          - not_null
          
      - name: unit_price_ex_vat
        data_type: decimal(20,6)
        description: "{{ doc('column__unit_price_ex_vat') }}"
        data_tests:
          - not_null

  - name: analyticsdb_shared__budget
    description: "Table containing output from the longterm budget forecast model. Manually updated."
    columns:
      - name: budget_id
        data_type: varchar(36)
        description: "{{ doc('column__budget_id') }}"
        constraints:
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: budget_type_id
        data_type: varchar(36)
        description: "{{ doc('column__budget_type_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: budget_segment_id
        data_type: varchar(36)
        description: "{{ doc('column__budget_segment_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: company_id
        data_type: varchar(36)
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: budget_year
        data_type: int
        description: "{{ doc('column__budget_year') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: financial_year
        data_type: int
        description: "{{ doc('column__financial_year') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: financial_quarter
        data_type: int
        description: "{{ doc('column__financial_quarter') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: financial_month_number
        data_type: int
        description: "{{ doc('column__financial_month_number') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: financial_week
        data_type: int
        description: "{{ doc('column__financial_week') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: budget_number_of_orders
        data_type: int
        description: "{{ doc('column__budget_number_of_orders') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: budget_atv_gross_ex_vat
        data_type: decimal(19,4)
        description: "{{ doc('column__budget_atv_gross_ex_vat') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: budget_order_value_gross_ex_vat
        data_type: decimal(19,4)
        description: "{{ doc('column__budget_order_value_gross_ex_vat') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: analyticsdb_shared__budget_types
    description: "Table containing the 4 different budget types that is completed every year. Static table"
    columns:
      - name: budget_type_id
        data_type: varchar(36)
        description: "{{ doc('column__budget_type_id') }}"
        constraints:
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: budget_type_name
        data_type: string
        description: "{{ doc('column__budget_type_name') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: budget_type_description
        data_type: string
        description: "{{ doc('column__budget_type_description') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null


      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: analyticsdb_shared__budget_segments
    description: "Table containing the types customer segments that orders/atv are split on. Static table"        
    alias: analyticsdb_shared__budget_segments        
    columns:
      - name: budget_segment_id
        data_type: varchar(36)
        description: "{{ doc('column__budget_segment_id') }}"
        constraints:
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: budget_segment_name
        data_type: string
        description: "{{ doc('column__budget_segment_name') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: budget_segment_description
        data_type: string
        description: "{{ doc('column__budget_segment_description') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: analyticsdb_shared__budget_aquisition_targets
    description: "Table containing the input from growth/customer on target number of aquisitions"        
    alias: analyticsdb_shared__budget_aquisition_targets 
    columns:

      - name: monthly_aquisition_target
        data_type: int
        description: "{{ doc('column__monthly_aquisition_target') }}"

      - name: financial_year
        data_type: int
        description: "{{ doc('column__financial_year') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: financial_month_number
        data_type: int
        description: "{{ doc('column__financial_month_number') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: budget_year
        data_type: int
        description: "{{ doc('column__budget_year') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null
      
      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: budget_marketing_input_id
        data_type: varchar(36)
        description: "{{ doc('column__budget_marketing_input_id') }}"
        constraints:
          - type: not_null
          - type: unique
        data_tests:
          - not_null
          - unique
      
      - name: company_id
        data_type: varchar(36)
        description: "{{ doc('column__company_id') }}"
        constraints:
          - type: not_null

      - name: budget_type_id
        data_type: varchar(36)
        description: "{{ doc('column__budget_type_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null  
      