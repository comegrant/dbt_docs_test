# DOUCMENTATION: https://docs.getdbt.com/reference/model-properties

version: 2

models:

  - name: cms__loyalty_events
    description: "Information about the events that affect the customers accumulated loyalty level points."

    columns:
      - name: loyalty_event_id
        data_type: varchar(36)
        description: "{{ doc('column__loyalty_event_id') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: loyalty_event_name
        data_type: string
        description: "{{ doc('column__loyalty_event_name') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__companies
    description: "The companies of Cheffelo."
    columns:
      - name: company_id
        data_type: varchar(36)
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - unique
          - not_null

      - name: country_id
        data_type: varchar(36)
        description: "{{ doc('column__country_id') }}"
        data_tests:
          - not_null

      - name: company_name
        data_type: string
        description: "{{ doc('column__company_name') }}"
        data_tests:
          - unique
          - not_null
  
  - name: cms__countries
    description: "Information relevant for each country Cheffelo operates in."
    columns:
      - name: country_id
        data_type: varchar(36)
        description: "{{ doc('column__country_id') }}"
        data_tests:
          - unique
          - not_null

      - name: language_id
        data_type: int
        description: "{{ doc('column__language_id') }}"
        data_tests:
          - not_null

      - name: country_name
        data_type: string
        description: "{{ doc('column__country_name') }}"
        data_tests:
          - not_null

      - name: country_currency
        data_type: string
        description: "{{ doc('column__country_currency') }}"
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null

  - name: cms__billing_agreement_orders
    description: "All placed orders. Gets populated at order gen and updated if the order changes."
    columns:
      - name: billing_agreement_order_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_order_id') }}"
        data_tests:
          - unique
          - not_null

      - name: ops_order_id
        data_type: bigint
        description: "{{ doc('column__ops_order_id') }}"
        data_tests:
          - unique

      - name: order_type_id
        data_type: varchar(36)
        description: "{{ doc('column__order_type_id') }}"
        data_tests:
          - not_null

      - name: order_status_id
        data_type: varchar(36)
        description: "{{ doc('column__order_status_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        data_tests:
          - not_null

      - name: menu_year
        data_type: int
        description: "{{ doc('column__menu_year') }}"
        data_tests:
          - not_null

      - name: menu_week
        data_type: int
        description: "{{ doc('column__menu_week') }}"
        data_tests:
          - not_null

      - name: has_recipe_leaflets
        data_type: boolean
        description: "{{ doc('column__has_recipe_leaflets') }}"
        data_tests:
          - not_null

      - name: menu_week_monday_date
        data_type: date
        description: "{{ doc('column__menu_week_monday_date') }}"
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at_orders') }}"
        data_tests:
          - not_null:
              config:
                where: "menu_year > 2021"

  - name: cms__billing_agreement_order_lines
    description: "Order lines of all placed orders. Gets populated at order gen and updated if the order changes."
    columns:
      - name: billing_agreement_order_line_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_order_line_id') }}"
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_order_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_order_id') }}"
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: varchar(36)
        description: "{{ doc('column__product_variation_id') }}"
        data_tests:
          - not_null

      - name: order_line_type_name
        data_type: string
        description: "{{ doc('column__order_line_type_name') }}"
        data_tests:
          - not_null
          - accepted_values:
              values: [
                  'CREDIT', 
                  'PRP', 
                  'P4P', 
                  'DISCOUNT', 
                  'DISCOUNT_GIFT', 
                  'INVOICE', 
                  'DEBIT', 
                  'TRANSPORT', 
                  'LOYALTY_CREDIT', 
                  'DEBIT_GIFT'
              ]
              
      - name: product_variation_quantity
        data_type: int
        description: "{{ doc('column__product_variation_quantity') }}"
        data_tests:
          - not_null

      - name: vat
        data_type: decimal(10,8)
        description: "{{ doc('column__vat') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn

      - name: unit_price_ex_vat
        data_type: decimal(20,6)
        description: "{{ doc('column__unit_price_ex_vat') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn

      - name: unit_price_inc_vat
        data_type: decimal(32,14)
        description: "{{ doc('column__unit_price_inc_vat') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn

      - name: total_amount_ex_vat
        data_type: decimal(31,6)
        description: "{{ doc('column__total_amount_ex_vat') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn
      - name: total_amount_inc_vat
        data_type: decimal(38,9)
        description: "{{ doc('column__total_amount_inc_vat') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn

  - name: cms__billing_agreement_order_statuses
    description: "Order lines of all placed orders. Gets populated at order gen and updated if the order changes."
    columns:
      - name: order_status_id
        data_type: varchar(36)
        description: "{{ doc('column__order_status_id') }}"
        data_tests:
          - unique
          - not_null

      - name: order_status_name
        data_type: string
        description: "{{ doc('column__order_status_name') }}"
        data_tests:
          - not_null
          - accepted_values:
              values: [
                'Created',
                'Processing',
                'Hold',
                'Waiting',
                'Cancelled',
                'Finished'
              ]

      - name: can_be_cancelled
        data_type: boolean
        description: "{{ doc('column__can_be_cancelled') }}"
        data_tests:
          - not_null

  - name: cms__order_types
    description: "Order lines of all placed orders. Gets populated at order gen and updated if the order changes."
    columns:
      - name: order_type_id
        data_type: varchar(36)
        description: "{{ doc('column__order_type_id') }}"
        data_tests:
          - unique
          - not_null

      - name: order_type_name
        data_type: string
        description: "{{ doc('column__order_type_name') }}"
        data_tests:
          - not_null
          - accepted_values:
              values: [
                'Order After Registration',
                'Daily Direct Order',
                'Service Purchase',
                'Loyalty',
                'Sales Order Estimates',
                'Sales Order Extras',
                'Recurring',
                'Campaign',
                'Gift Card',
                'Orders After Cutoff'
              ]

      - name: is_direct_order
        data_type: boolean
        description: "{{ doc('column__is_direct_order') }}"
        data_tests:
          - not_null

      - name: allows_anonymous
        data_type: boolean
        description: "{{ doc('column__allows_anonymous') }}"
        data_tests:
          - not_null

      - name: is_direct_payment
        data_type: boolean
        description: "{{ doc('column__is_direct_payment') }}"
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null
              
  - name: cms__billing_agreements
    description: "Information about an billing agreement. Use SCD2 when updated in the source system."
    data_tests:
      - unique:
          column_name: "(billing_agreement_id || '-' || valid_from)"
    columns:
      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        data_tests:
          - not_null

      - name: company_id
        data_type: varchar(36)
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_status_id
        data_type: int
        description: "{{ doc('column__billing_agreement_status_id') }}"
        data_tests:
          - not_null

      - name: sales_point_id
        data_type: int
        description: "{{ doc('column__sales_point_id') }}"

      - name: payment_method
        data_type: string
        description: "{{ doc('column__payment_method') }}"
        data_tests:
          - not_null
          - accepted_values:
              values: [
                'INVOICE',                         
                'CC',                              
                'ADYEN',
                'COLLECTOR',
                'FLEX',
                'MANUAL',
                'VIPPS'
              ]
              config:
                severity: warn


      - name: signup_source
        data_type: string
        description: "{{ doc('column__signup_source') }}"
        data_tests:
          - accepted_values:
              values: [
                  'SALES',
                  'WEB',
                  'FLEX'
              ]

      - name: signup_salesperson
        data_type: string
        description: "{{ doc('column__signup_salesperson') }}"

      - name: signup_date
        data_type: date
        description: "{{ doc('column__signup_date') }}"
        data_tests:
          - not_null

      - name: signup_year_day
        data_type: int
        description: "{{ doc('column__signup_year_day') }}"
        data_tests:
          - not_null

      - name: signup_month_day
        data_type: int
        description: "{{ doc('column__signup_month_day') }}"
        data_tests:
          - not_null

      - name: signup_week_day
        data_type: int
        description: "{{ doc('column__signup_week_day') }}"
        data_tests:
          - not_null

      - name: signup_week
        data_type: int
        description: "{{ doc('column__signup_week') }}"
        data_tests:
          - not_null

      - name: signup_month
        data_type: int
        description: "{{ doc('column__signup_month') }}"
        data_tests:
          - not_null

      - name: signup_quarter
        data_type: int
        description: "{{ doc('column__signup_quarter') }}"
        data_tests:
          - not_null

      - name: signup_year
        data_type: int
        description: "{{ doc('column__signup_year') }}"
        data_tests:
          - not_null

      - name: start_date
        data_type: date
        description: "{{ doc('column__start_date') }}"
        data_tests:
          - not_null

      - name: start_year_day
        data_type: int
        description: "{{ doc('column__start_year_day') }}"
        data_tests:
          - not_null

      - name: start_month_day
        data_type: int
        description: "{{ doc('column__start_month_day') }}"
        data_tests:
          - not_null

      - name: start_week_day
        data_type: int
        description: "{{ doc('column__start_week_day') }}"
        data_tests:
          - not_null

      - name: start_week
        data_type: int
        description: "{{ doc('column__start_week') }}"
        data_tests:
          - not_null

      - name: start_month
        data_type: int
        description: "{{ doc('column__start_month') }}"
        data_tests:
          - not_null

      - name: start_quarter
        data_type: int
        description: "{{ doc('column__start_quarter') }}"
        data_tests:
          - not_null

      - name: start_year
        data_type: int
        description: "{{ doc('column__start_year') }}"
        data_tests:
          - not_null

      - name: signup_at
        data_type: timestamp
        description: "{{ doc('column__signup_at') }}"
        data_tests:
          - not_null

      - name: valid_from
        data_type: timestamp
        description: "{{ doc('column__valid_from') }}"
        data_tests:
          - not_null

      - name: valid_to
        data_type: timestamp
        description: "{{ doc('column__valid_to') }}"

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn

  - name: cms__billing_agreement_statuses
    description: "Information about the status an billing agreement can have"
    columns:
      - name: billing_agreement_status_id
        data_type: int
        description: "{{ doc('column__billing_agreement_status_id') }}"
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_status_name
        data_type: string
        description: "{{ doc('column__billing_agreement_status_name') }}"
        data_tests:
          - not_null
          - accepted_values:
                values: [
                    'Pending',
                    'Missing Key',
                    'Postal Area Geo Restricted',
                    'Active',
                    'Deleted',
                    'Freezed',
                    'Fraud',
                    'Locked',
                    'Leads',
                    'Bad Player (avida)',
                    'Postal Area Closed'
                ]

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null
  
  - name: cms__billing_agreement_addon_subscriptions
    description: "Link addon subscriptions to billing agreements. Only have rows for billing agreements that have or have had the addon subscription."
    columns:
      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        data_tests:
          - not_null

      - name: addon_subscription_id
        data_type: varchar(36)
        description: "{{ doc('column__addon_subscription_id') }}"
        data_tests:
          - not_null

      - name: company_id
        data_type: varchar(36)
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: is_active
        data_type: boolean
        description: "{{ doc('column__is_active_addon_subscription') }}"
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null
  
  - name: cms__addon_subscriptions
    description: "Information about all the different addon subscriptions that exists"
    columns:
      - name: addon_subscription_id
        data_type: varchar(36)
        description: "{{ doc('column__addon_subscription_id') }}"
        data_tests:
          - unique
          - not_null

      - name: company_id
        data_type: varchar(36)
        description: "{{ doc('column__company_id') }}"
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: varchar(36)
        description: "{{ doc('column__product_variation_id') }}"
        data_tests:
          - not_null

      - name: addon_subscription_name
        data_type: string
        description: "{{ doc('column__addon_subscription_name') }}"
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null

  - name: cms__loyalty_agreement_ledger
    description: "Table tracking accrued loyalty points for each billing agreements when ever an event that changes the obtained points is happening."
    columns:
      - name: loyalty_agreement_ledger_id
        data_type: varchar(36)
        description: "{{ doc('column__loyalty_agreement_ledger_id') }}"
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        data_tests:
          - not_null

      - name: loyalty_event_id
        data_type: varchar(36)
        description: "{{ doc('column__loyalty_event_id') }}"
        data_tests:
          - not_null

      - name: loyalty_level_id
        data_type: varchar(36)
        description: "{{ doc('column__loyalty_level_id') }}"
        data_tests:
          - not_null

      - name: accrued_points
        data_type: int
        description: "{{ doc('column__accrued_points') }}"
        data_tests:
          - not_null

      - name: points_generated_at
        data_type: timestamp
        description: "{{ doc('column__points_generated_at') }}"
        data_tests:
          - not_null
    
  - name: cms__loyalty_levels
    description: "..."
    columns:
      - name: loyalty_level_id
        data_type: varchar(36)
        description: "{{ doc('column__loyalty_level_id') }}"
        data_tests:
          - unique
          - not_null

      - name: loyalty_level_number
        data_type: int
        description: "{{ doc('column__loyalty_level_number') }}"
        data_tests:
          - not_null
  - name: cms__billing_agreement_basket_deviations
    description: "All baskets that have a change for a particular menu week made by either the recommendation engine, customers or customer service"
    data_tests:
      - unique:
          column_name: "(billing_agreement_basket_id || menu_year || menu_week )"
          config:
            where: "is_active_deviation = true"
    columns:
      - name: billing_agreement_basket_deviation_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_deviation_id') }}"
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_basket_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_basket_deviation_origin_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        data_tests:
          - not_null

      - name: delivery_week_type_id
        data_type: int
        description: "{{ doc('column__delivery_week_type_id') }}"
        data_tests:
          - not_null

      - name: menu_year
        data_type: int
        description: "{{ doc('column__menu_year') }}"
        data_tests:
          - not_null

      - name: menu_week
        data_type: int
        description: "{{ doc('column__menu_week') }}"
        data_tests:
          - not_null

      - name: is_active_deviation
        data_type: boolean
        description: "{{ doc('column__is_active_basket_deviation') }}"
        data_tests:
          - not_null

      - name: menu_week_monday_date
        data_type: date
        description: "{{ doc('column__menu_week_monday_date') }}"
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: varchar(255)
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn

  - name: cms__billing_agreement_basket_deviation_products
    description: "Holds information about the products in a billing agreements basket deviation. Links to `cms__billing_agreement_basket_deviations`."
    columns:
      - name: billing_agreement_basket_deviation_product_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_deviation_product_id') }}"
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_basket_deviation_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_deviation_id') }}"
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: varchar(36)
        description: "{{ doc('column__product_variation_id') }}"
        data_tests:
          - not_null

      - name: product_variation_quantity
        data_type: int
        description: "{{ doc('column__product_variation_quantity') }}"
        data_tests:
          - not_null

      - name: is_extra_product
        data_type: boolean
        description: "{{ doc('column__is_extra_basket_product') }}"

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn

      - name: source_updated_at
        data_type: string
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn


      - name: source_updated_by
        data_type: timestamp
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null:
              config:
                  severity: warn
  - name: cms__billing_agreement_baskets
    description: "The basket related to a billing agreement. Each billing agreement can only have one basket."
    data_tests:
      - unique:
          column_name: "(billing_agreement_basket_id || '-' || valid_from)"
      - unique:
          column_name: "(billing_agreement_id || '-' || valid_from)"
    columns:
      - name: billing_agreement_basket_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        data_tests:
          - not_null

      - name: shipping_address_id
        data_type: varchar(36)
        description: "{{ doc('column__shipping_address_id_basket') }}"
        data_tests:
          - not_null

      - name: basket_delivery_week_type_id
        data_type: int
        description: "{{ doc('column__delivery_week_type_id') }}"
        data_tests:
          - not_null

      - name: timeblock_id
        data_type: int
        description: "{{ doc('column__timeblock_id_basket') }}"
        data_tests:
          - not_null

      - name: is_default_basket
        data_type: boolean
        description: "{{ doc('column__is_default_basket') }}"
        data_tests:
          - not_null

      - name: is_active_basket
        data_type: boolean
        description: "{{ doc('column__is_active_basket') }}"
        data_tests:
          - not_null

      - name: valid_from
        data_type: timestamp
        description: "{{ doc('column__valid_from') }}"
        data_tests:
          - not_null

      - name: valid_to
        data_type: timestamp
        description: "{{ doc('column__valid_to') }}"
        data_tests:
          - not_null


      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null:
              config:
                severity: warn

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null:
              config:
                severity: warn

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null:
              config:
                severity: warn

  - name: cms__billing_agreement_basket_products
    description: "Holds information about the products in a billing agreements basket before any deviations has been made. Links to `cms__billing_agreement_baskets`."
    data_tests:
      - unique:
          column_name: "(billing_agreement_basket_product_id || '-' || valid_from)"
    columns:
      - name: billing_agreement_basket_product_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_product_id') }}"
        data_tests:
          - not_null

      - name: billing_agreement_basket_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_id') }}"
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: varchar(36)
        description: "{{ doc('column__product_variation_id') }}"
        data_tests:
          - not_null

      - name: product_delivery_week_type_id
        data_type: int
        description: "{{ doc('column__delivery_week_type_id') }}"
        data_tests:
          - not_null

      - name: product_variation_quantity
        data_type: int
        description: "{{ doc('column__product_variation_quantity') }}"
        data_tests:
          - not_null

      - name: is_extra_product
        data_type: boolean
        description: "{{ doc('column__is_extra_basket_product') }}"

      - name: valid_from
        data_type: timestamp
        description: "{{ doc('column__valid_from') }}"
        data_tests:
          - not_null

      - name: valid_to
        data_type: timestamp
        description: "{{ doc('column__valid_to') }}"

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null:
              config:
                severity: warn

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null:
              config:
                severity: warn

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null:
              config:
                severity: warn
                
  - name: cms__billing_agreement_basket_deviation_origins
    description: "The different types of origin a basket deviation can have."
    columns:
      - name: billing_agreement_basket_deviation_origin_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_deviation_origin_id') }}"
        data_tests:
          - unique
          - not_null

      - name: basket_deviation_origin_source_name
        data_type: string
        description: "{{ doc('column__basket_deviation_origin_source_name') }}"
        data_tests:
          - not_null
          - accepted_values:
              values: [
                'Normal', 
                'Recommendations', 
                'OneSub - Recommendations'
                ]
              config:
                severity: warn

      - name: basket_deviation_origin_name
        data_type: string
        description: "{{ doc('column__basket_deviation_origin_name') }}"
        data_tests:
          - not_null
          - accepted_values:
              values: [
                'Normal', 
                'Mealselector', 
                'Preselector'
                ]
              config:
                severity: warn

      - name: preselector_category
        data_type: string
        description: "{{ doc('column__preselector_category') }}"
        data_tests:
          - not_null
          - accepted_values:
              values: [
                'Not Preselector', 
                'Preselector'
                ]
              config:
                severity: warn

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        data_tests:
          - not_null

  - name: cms__delivery_week_types
    description: "The delivery intervals a subscription can have."
    columns:
      - name: delivery_week_type_id
        data_type: int
        description: "{{ doc('column__delivery_week_type_id') }}"
        data_tests:
          - unique
          - not_null

      - name: delivery_week_type_name
        data_type: varchar(50)
        description: "{{ doc('column__delivery_week_type_name') }}"
        data_tests:
          - not_null

  - name: cms__preferences
    description: "Preferences and concepts/attributes that a customer can choose"
    columns:
      - name: preference_id
        data_type: varchar(36)
        description: "{{ doc('column__preference_id') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: preference_type_id
        data_type: varchar(36)
        description: "{{ doc('column__preference_type_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: preference_name_general
        data_type: string
        description: "{{ doc('column__preference_name_general') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: preference_description_general
        data_type: string
        description: "{{ doc('column__preference_description_general') }}"

      - name: is_allergen
        data_type: boolean
        description: "{{ doc('column__is_allergen') }}"

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__preference_types
    description: "Preference types (e.g. concept, taste etc.)"
    columns:
      - name: preference_type_id
        data_type: varchar(36)
        description: "{{ doc('column__preference_type_id') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: preference_type_name
        data_type: string
        description: "{{ doc('column__preference_type_name') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: preference_type_description
        data_type: string
        description: "{{ doc('column__preference_type_description') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__preferences_companies
    description: "The preferences with name and description for each company"
    columns:
      - name: preference_id
        data_type: varchar(36)
        description: "{{ doc('column__preference_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: company_id
        data_type: varchar(36)
        description: "{{ doc('column__company_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: preference_name
        data_type: string
        description: "{{ doc('column__preference_name') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: preference_description
        data_type: string
        description: "{{ doc('column__preference_description') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: is_active_preference
        data_type: boolean
        description: "{{ doc('column__is_active_preference') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__preference_attribute_values
    description: "Different attributes a preference can have, e.g. which pre OneSub mealbox a concept preference corresponds too."
    data_tests:
      - unique:
          column_name: "(preference_id || '-' || attribute_id || '-' || company_id)"
    columns:
      - name: attribute_id
        data_type: varchar(36)
        description: "{{ doc('column__attribute_id_preference') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: preference_id
        data_type: varchar(36)
        description: "{{ doc('column__preference_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: company_id
        data_type: varchar(36)
        description: "{{ doc('column__company_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: attribute_value
        data_type: string
        description: "{{ doc('column__attribute_value_preference') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__register_info_baskets
    description: "Information about the basket the customer chose on registration."
    columns:
      - name: register_info_basket_id
        data_type: varchar(36)
        description: "{{ doc('column__register_info_basket_id') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        constraints:
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: delivery_week_type_id
        data_type: int
        description: "{{ doc('column__delivery_week_type_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: billing_agreement_status_id
        data_type: int
        description: "{{ doc('column__billing_agreement_status_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: start_date
        data_type: date
        description: "{{ doc('column__start_date') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__register_info_products
    description: "Contain the product variation(s) the customer subscribed to on registration."
    columns:
      - name: register_info_product_id
        data_type: varchar(36)
        description: "{{ doc('column__register_info_product_id') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: register_info_basket_id
        data_type: varchar(36)
        description: "{{ doc('column__register_info_basket_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: product_variation_id
        data_type: varchar(36)
        description: "{{ doc('column__product_variation_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: product_variation_quantity
        data_type: int
        description: "{{ doc('column__product_variation_quantity') }}"

  - name: cms__billing_agreements_preferences_list
    description: "The subscribed preferences of billing agreements in a list format. Its based on cms__billing_agreement_preferences and is used in the scd logic in dim_billing_agreements."
    data_tests:
      - unique:
          column_name: "(billing_agreement_id || '-' || valid_from)"
    columns:
      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: preference_id_list
        data_type: array<string>
        description: "{{ doc('column__preference_id_list') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: billing_agreement_preference_id_list
        data_type: array<string>
        description: "{{ doc('column__billing_agreement_preference_id_list') }}" 
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: valid_from
        data_type: timestamp
        description: "{{ doc('column__valid_from') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: valid_to
        data_type: timestamp
        description: "{{ doc('column__valid_to') }}"

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__billing_agreement_basket_products_list
    description: "The basket products of a billing agreements in a list format. Its based on cms__billing_agreement_basket_products and is used to complement cms__billing_agreement_preferences with concept preferences."
    data_tests:
      - unique:
          column_name: "(billing_agreement_basket_id || '-' || valid_from)"
    columns:
      - name: billing_agreement_basket_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: basket_products_list
        data_type: array<struct<product_variation_id:string,product_variation_quantity:int,is_extra:boolean>>
        description: "{{ doc('column__basket_products_list') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: valid_from
        data_type: timestamp
        description: "{{ doc('column__valid_from') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: valid_to
        data_type: timestamp
        description: "{{ doc('column__valid_to') }}"

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"

  - name: cms__billing_agreement_basket_scheduler
    columns:
      - name: billing_agreement_basket_scheduler_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_scheduler_id') }}"
        data_tests:
          - unique
          - not_null

      - name: billing_agreement_basket_id
        data_type: varchar(36)
        description: "{{ doc('column__billing_agreement_basket_id') }}"
        data_tests:
          - not_null

      - name: menu_year
        data_type: int
        description: "{{ doc('column__menu_year') }}"
        data_tests:
          - not_null

      - name: menu_week
        data_type: int
        description: "{{ doc('column__menu_week') }}"
        data_tests:
          - not_null

      - name: delivery_week_type_id
        data_type: int
        description: "{{ doc('column__delivery_week_type_id') }}"
        data_tests:
          - not_null
      
      - name: billing_agreement_basket_menu_week_id
        data_type: string
        description: "{{ doc('column__billing_agreement_basket_menu_week_id') }}"
        data_tests:
          - unique
          - not_null
      
      - name: timeblock
        data_type: int 
        description: "{{ doc('column__timeblock') }}"
      
      - name: has_delivery
        data_type: boolean
        description: "{{ doc('has_delivery') }}"

      - name: menu_week_monday_date
        data_type: date
        description: "{{ doc('column__menu_week_monday_date') }}"
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"

  - name: cms__onesub_beta_agreements
    description: "List of billing agreements that have been used for the internal launch and 10% customer launch of Onesub."
    columns: 
      - name: billing_agreement_id
        data_type: string
        description: "{{ doc('column__billing_agreement_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: is_internal
        data_type: boolean
        description: "{{ doc('column__is_internal') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__billing_agreement_consents
    description: "Overview of customer's consents. If a row exists it means that the customer has consented at some point in time. If a consent is removed by the customer the is_accepted flag get changed to false."
    data_tests:
      - unique:
          column_name: "(billing_agreement_consent_id || '-' || valid_from)"
    columns:
      - name: billing_agreement_consent_id
        data_type: string
        description: "{{ doc('column__billing_agreement_consent_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: billing_agreement_id
        data_type: int
        description: "{{ doc('column__billing_agreement_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: consent_id
        data_type: varchar(36)
        description: "{{ doc('column__consent_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: company_id
        data_type: varchar(36)
        description: "{{ doc('column__company_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: is_accepted_consent
        data_type: boolean
        description: "{{ doc('column__is_accepted_consent') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: valid_from
        data_type: timestamp
        description: "{{ doc('column__valid_from') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: valid_to
        data_type: timestamp
        description: "{{ doc('column__valid_to') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp_ntz
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__consent_categories
    description: "Holds information about the differenct categories of consents."
    columns:
      - name: consent_category_id
        data_type: char(36)
        description: "{{ doc('column__consent_category_id') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: consent_category_name
        data_type: string
        description: "{{ doc('column__consent_category_name') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

  - name: cms__consents
    description: "Holds information about the different types of consents that exist."
    columns:
      - name: consent_id
        data_type: char(36)
        description: "{{ doc('column__consent_id') }}"
        constraints:
          - type: primary_key
          - type: unique
          - type: not_null
        data_tests:
          - unique
          - not_null

      - name: company_id
        data_type: char(36)
        description: "{{ doc('column__company_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: consent_category_id
        data_type: char(36)
        description: "{{ doc('column__consent_category_id') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: consent_name
        data_type: string
        description: "{{ doc('column__consent_name') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_at
        data_type: timestamp
        description: "{{ doc('column__source_created_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_created_by
        data_type: string
        description: "{{ doc('column__source_created_by') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_at
        data_type: timestamp
        description: "{{ doc('column__source_updated_at') }}"
        constraints:
          - type: not_null
        data_tests:
          - not_null

      - name: source_updated_by
        data_type: string
        description: "{{ doc('column__source_updated_by') }}"
