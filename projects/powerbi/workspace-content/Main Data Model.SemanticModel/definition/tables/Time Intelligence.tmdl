table 'Time Intelligence'
	lineageTag: 4067c429-0c5a-430e-a01b-a002f6b8a92c

	calculationGroup

		calculationItem Current = SELECTEDMEASURE()

		calculationItem PY =

				VAR SelectedFinancialYear = SELECTEDVALUE(Dates[Financial Year])
				VAR SelectedFinancialQuarter = SELECTEDVALUE(Dates[Financial Quarter])
				VAR SelectedFinancialMonth = SELECTEDVALUE(Dates[Financial Month Number])
				VAR SelectedFinancialWeek = SELECTEDVALUE(Dates[Financial Week])

				RETURN
				    SWITCH(
				        TRUE(),

				        ISINSCOPE(Dates[Date]) || ISINSCOPE(Dates[Calendar Quarter]) || ISINSCOPE(Dates[Calendar Month Number]) || ISINSCOPE(Dates[Calendar Year]),
						CALCULATE(
				            SELECTEDMEASURE(),
				            DATEADD(Dates[Date], -1, YEAR),
				            REMOVEFILTERS(Dates)
				        ),

				        ISINSCOPE(Dates[Financial Week]),
						CALCULATE(
				            SELECTEDMEASURE(),
				            Dates[Financial Year] = SelectedFinancialYear - 1,
				            Dates[Financial Week] = SelectedFinancialWeek,
				            REMOVEFILTERS(Dates)
				        ),

				        ISINSCOPE(Dates[Financial Month Name]),
						CALCULATE(
				            SELECTEDMEASURE(),
				            Dates[Financial Year] = SelectedFinancialYear - 1,
				            Dates[Financial Month Number] = SelectedFinancialMonth,
				            REMOVEFILTERS(Dates)
				        ),

				        ISINSCOPE(Dates[Financial Quarter]),
						CALCULATE(
				            SELECTEDMEASURE(),
				            Dates[Financial Year] = SelectedFinancialYear - 1,
				            Dates[Financial Quarter] = SelectedFinancialQuarter,
				            REMOVEFILTERS(Dates)
				        ),

				        ISINSCOPE(Dates[Financial Year]),
						CALCULATE(
				            SELECTEDMEASURE(),
				            Dates[Financial Year] = SelectedFinancialYear - 1,
				            REMOVEFILTERS(Dates)
				        ),

                        CALCULATE(
				            SELECTEDMEASURE(),
				            SAMEPERIODLASTYEAR(Dates[Date]),
				            REMOVEFILTERS(Dates)
				        )

				    )

		calculationItem 'Diff PY' =
				SELECTEDMEASURE() -
				    CALCULATE(
				        SELECTEDMEASURE(),
				        'Time Intelligence'[Time Calculation] = "PY"
				    )

		calculationItem YOY% =
				DIVIDE(
				    CALCULATE(
				        SELECTEDMEASURE(),
				        'Time Intelligence'[Time Calculation]="Diff PY"
				    ),
				    CALCULATE(
				        SELECTEDMEASURE(),
				        'Time Intelligence'[Time Calculation]="PY"
				    )
				)

			formatStringDefinition = "0.00%;-0.00%;0.00%"

		calculationItem CY/PY =
			DIVIDE(
				CALCULATE(
					SELECTEDMEASURE(),
					'Time Intelligence'[Time Calculation]="Current"
				),
				CALCULATE(
					SELECTEDMEASURE(),
					'Time Intelligence'[Time Calculation]="PY"
				)
			)

		calculationItem YTD =

			VAR SelectedFinancialYear = SELECTEDVALUE(Dates[Financial Year])
			VAR LastWeekAvailable = CALCULATE( MAX(Dates[Financial Week]), Dates[is_future_menu_week] = false)

			RETURN
				SWITCH(
					TRUE(),

					ISINSCOPE(Dates[Date]) || ISINSCOPE(Dates[Calendar Quarter]) || ISINSCOPE(Dates[Calendar Month Number]) || ISINSCOPE(Dates[Calendar Year]),
					TOTALYTD(
						SELECTEDMEASURE(),
						Dates[Date],
						REMOVEFILTERS(Dates)
					),

					ISINSCOPE(Dates[Financial Year]),
					CALCULATE(
						SELECTEDMEASURE(),
						Dates[Financial Year] = SelectedFinancialYear,
						Dates[Financial Week] <= LastWeekAvailable,
						REMOVEFILTERS(Dates)
					),

					TOTALYTD(
						SELECTEDMEASURE(),
						Dates[Date],
						REMOVEFILTERS(Dates)
					)
				)

		calculationItem PYTD =

			VAR PreviousFinancialYear = SELECTEDVALUE(Dates[Financial Year]) - 1
			VAR LastWeekAvailable = CALCULATE( MAX(Dates[Financial Week]), Dates[is_future_menu_week] = false)

			RETURN
				SWITCH(
					TRUE(),

					ISINSCOPE(Dates[Date]) || ISINSCOPE(Dates[Calendar Quarter]) || ISINSCOPE(Dates[Calendar Month Number]) || ISINSCOPE(Dates[Calendar Year]),
					CALCULATE(
						TOTALYTD(
							SELECTEDMEASURE(),
							Dates[Date]
						),
						DATEADD(Dates[Date], -1, YEAR),
						REMOVEFILTERS(Dates)
					),

					ISINSCOPE(Dates[Financial Year]), CALCULATE(
						SELECTEDMEASURE(),
						'Dates'[Financial Year] = PreviousFinancialYear,
						'Dates'[Financial Week] <= LastWeekAvailable,
						REMOVEFILTERS(Dates)
					),

					TOTALYTD(
						CALCULATE(
							SELECTEDMEASURE(),
							'Time Intelligence'[Time Calculation]="PY"
						),
						Dates[Date],
						REMOVEFILTERS(Dates)
					)
				)

	column 'Time Calculation'
		dataType: string
		lineageTag: 62edac33-e451-4d18-8c03-e0299694591d
		summarizeBy: none
		sourceColumn: Name
		sortByColumn: Ordinal

		annotation SummarizationSetBy = Automatic

	column Ordinal
		dataType: int64
		formatString: 0
		lineageTag: 5ac4bd59-eb39-4494-b338-9df444561eba
		summarizeBy: sum
		sourceColumn: Ordinal

		annotation SummarizationSetBy = Automatic
